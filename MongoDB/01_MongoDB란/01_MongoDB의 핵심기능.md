## MongoDB 특징

- MongoDB는 웹 애플리케이션과 인터넷 기반을 위해 설계된 데이터베이스 관리 시스템이다.

- 데이터 모델과 지속성 전략은 높은 읽기/쓰기 효율과 자동 장애조치를 통한 확장의 용이성을 염두에 두고 만들어졌다.

- MongoDB의 도큐먼트 형식은 임의의 데이터 구조를 저장하는 스키마로 잘 알려진 JSON에 기반한다. 

- MongnDB에서는 프로그래밍 언어에서 정의한 객체가 그대로 저장되므로 객체 매퍼의 복잡성이 사라진다.

- MongoDB는 도큐먼트 지향적인 데이터베이스이다.(도큐먼트는 본질적으로 속성의 이름과 값으로 이루어진 쌍의 집합이다.)

- 내부적으로 MongoDB는 BinaryJson혹은 BSON의 형태로 도큐먼트를 저장한다. 다시말해, 도큐먼트의 모음과 같은 데이터를 컬렉션에 도큐먼트로 저장한다.

- MongoDB는 웹 애플리케이션, 분석과 로깅 애플리케이션, 중간 정도의 캐시를 필요로 하는 애플리케이션에서 일차 데이터 저장시스템으로 적합하다.

- 또한 스키마가 존재하지 않는 데이터를 저장하기가 용이하므로 미리 구조가 알려지지 않은 데이터를 저장하는데 유용하다.

- 웹 애플리케이션에서 일차적 데이터 저장 시스템으로 사용하기에 적당하다.

- 도큐먼트는 다양한 구조의 데이터를 표현할 수 있으므로 필요한 컬렉션의 수는 동일한 데이터를 완전히 정규화된 관계 모델로 표현할 때 필요한 테이블의 수보다 훨씬 적다.

- 또한 웹 애플리케이션이 커져 감에 따라 필요한 확장성을 명쾌하게 제공한다.

## 스키마가 없는 모델의 장점

- 데이터베이스가 아닌 애플리케이션이 데이터 구조를 정한다. 이는 데이터의 구조가 빈번히 변경되는 개발 초기 단계에서 개발 속도를 단축시켜준다.
- RDBMS에서는 개체-속성-값 패턴을 통해 가변적인 속성을 처리하지만, NOSQL에서는 스키마가 없는 데이터 모델을 통해 처리할 수 있다.

## Ad hoc query의 지원

- 이는 시스템이 받아들일 수 있는 질의를 미리 정의할 필요가 없다는 것을 의미한다. 질의가 어떠한 조건을 갖더라도 올바른 구조이기만 하면 쿼리가 실행된다.
- 애드혹 쿼리의 위험요소는 데이터베이스를 생성할 때 모르는 값을 찾는 것이다. 이는 많은 도큐먼트를 데이터베이스에 추가할 수록 비용이 증가하게 된다.
- 이를 인덱스를 통해 해결할 수 있다.

## 인덱스

- MongoDB에서 인덱스는 B-tree로 구현되어 있다.
- 세컨더리 인덱스(pk를 제외한 모든 인덱스)를 허용함으로써 사용자가 넓은 범위의 쿼리를 최적화하도록 허락한다.

## 복제

- replica set(복제세트)라고 부르는 구성을 통해 데이터베이스 복제기능을 제공한다.

- 복제 세트는 서버와 네트워크 장애가 발생할 경우를 대비해 중복성과 장애조치 자동화를 위해 데이터를 여러 대의 서버에 분산한다.
- 웹에서와 같은 읽기 위주의 애플리케이션에서는 데이터베이스 읽기를 복제 세트 클러스터 내의 여러 서버에 분산할 수 있다.
- 복제 세트는 많은 MongoDB서버로 구성되어 있는데, 보통 각각의 MongoDB서버는 분리된 물리 장비에 별도로 존재하며 이를 노드라 부른다.
- 어느 순간이든 하나의 노드는 복제 세트의 primary node로 존재하며, 더불어 하나 또는 그 이상의 세컨더리 노드가 존재한다.
- 복제 세트의 프라이머리 노드에 대해서는 읽기와 쓰기가 모두 가능하지만, 세컨더리 노드는 읽기만 가능하다.
- 복제 세트의 고유한 기능은 자동 장애조치를 지원한다는 점이다.
- 프라이머리 노드에 장애가 발생하면 클러스터는 자동으로 세컨더리 가운데 하나를 선택해 프라이머리로 설정한다.
-  이전의 프라이머리 노드가 복구되면 복구된 프라이머리 노드는 세컨더리 노드로 작동한다.

## 내구성

- 쓰기 속도는 미리 정해진 시간 내에 데이터베이스가 얼마나 많은 수의 삽입, 수정, 삭제 명령을 처리할 수 있는가를 뜻한다.
- 내구성은 이 쓰기 연산이 디스크에 제대로 이루어졌다는 것을 확인할 수 있는 정도이다.

- MongoDB의 경우 시맨틱스와 저널링을 통해 속도와 내구성 사이에서 타협을 이룰 수 있다.
- 저널링은 모든 쓰기에 대한 로그를 100ms마다 한 번씩 저널 파일에 기록한다. 서버가 불시에 셧다운되면 저널은 MongoDB파일을 복구해서 서버를 재시작할 때 원래의 상태를 유지하는데 이용된다. 이것이 MongoDB를 실행하는 가장 안전한 방법이다.
- 쓰기 부하에 대한 성능을 향상시키기 위해 저널링을 하지 않은 채 서버를 실행할 수 있다. 이때의 단점은 불시에 셧다운될 때 데이터파일이 손상될 수 있다는 점이다.
- 그 결과 저널링을 사용하지 않는 경우, 장애가 발생하더라도 손상되지 않은 데이터 복사본을 가질 가능성을 높이기 위해 또 다른 데이터 센터에서 데이터베이스를 복제해야 한다.

### 확장

- 수직적 확장
  - 하드웨어를 업그레이드하여 병목현상을 완화시키는것.
- 수평적 확장
  - 데이터베이스를 여러 대의 서버에 분산시키는 것을 뜻한다.
  - 이때 한대의 서버가 전체 시스템에서 차지하는 비중이 훨씬 더 적으므로 장애로 인한 피해가 훨씬 작다.

- MongoDB는 샤딩으로 알려진 범위 기반 파티션 메커니즘을 통해 데이터를 여러 노드에 걸쳐 분산하는 것을 자동으로 관리해 준다.
- 샤딩 시스템은 샤드 노드를 추가해서 용량을 필요한 만큼 늘리고 자동 장애조치 기능도 제공한다.
- 또한 각각의 샤드는 최소한 두 개의 노드로 구성된 복제 세트로 이루어져있어 어느 한 노드에서도 장애가 발생하지 않은 채 자동으로 복구되도록 보장한다.
- 따라서 애플리케이션 코드에서 이러한 내부 메커니즘에 전혀 신경쓰지 않아도 된다는 것이다.

## 단점

- 32비트 시스템은 4GB의 메모리만 쓸 수 있다. 이는 메타데이터와 스토리지 오버헤드를 포함하는 데이터 세트가 4GB에 이르면 MongoDB는 더 이상의 데이터를 저장할 수 없게 된다. 따라서 64비트 시스템을 사용해야 한다.

- 가상메모리 매핑을 사용하기 때문에 MongoDB가 필요한 경우에 메모리를 자동으로 할당한다.
  - 따라서 데이터베이스를 공유 환경에서 실행하는것이 더 까다로워진다.(전용 서버에서 최적으로 실행하는것이 편하다.)
- 데이터 크기 관점에서 그렇게 효율적이지 않다.
  - 도큐먼트 키를 각 도큐먼트에 저장하는데 이는 'username' 이라는 필드 이름을 가진 모든 도큐먼트가 필드 이름을 저장하기 위해 8바이트를 사용함을 뜻한다.
- 복제세트와 샤드를 클러스터를 구성할 때 각각 설정되고 관리되어야 한다.(복제세트의 샤드를 허용하는데, 이는 데이터의 조각들이 오직 그 복제세트 내에서만 복제됨을 뜻한다.)

